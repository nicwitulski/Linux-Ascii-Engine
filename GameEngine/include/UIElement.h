//////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @file UIElement.h
/// @author Nicholas Witulski (nicwitulski@gmail.com)
/// @brief Defines a UI element and provides options to lock elements to edges/corners of terminal
/// @version 0.1
/// @date 2025-06-27
///
/// @copyright Copyright (c) 2025
///
//////////////////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef UIELEMENT_H
#define UIELEMENT_H

#include "Pixel.h"
#include "Printable.h"
#include <map>
#include <memory>
#include <vector>

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @class ScreenLockPosition
///
/// Enumeration defining possible screen lock positions for UI elements
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
enum class ScreenLockPosition
{
   NONE,
   TOP_LEFT_CORNER,
   TOP_MIDDLE,
   TOP_RIGHT_CORNER,
   RIGHT_MIDDLE,
   BOTTOM_RIGHT_CORNER,
   BOTTOM_MIDDLE,
   BOTTOM_LEFT_CORNER,
   LEFT_MIDDLE,
   CENTER
};

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @class StackDirection
///
/// Enumeration defining stacking direction for UI elements
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
enum class StackDirection
{
   VERTICAL,
   HORIZONTAL
};

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @class UIElement
///
/// Defines a UI element with edge locking capabilities for terminal positioning
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
class UIElement : public std::enable_shared_from_this<UIElement>, public Printable
{
protected:
   Position           m_maxPosition;
   Position           m_minPosition;
   ScreenLockPosition m_lockPosition;
   StackDirection     m_stackDirection;

   // Border properties
   bool               m_borderEnabled;
   int                m_borderWidth;
   int                m_borderHeight;
   bool               m_borderAutoSize;
   std::vector<Pixel> m_originalPixels; // Store original sprite without borders

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn setPositions
   ///
   /// Sets the max and min position based on the entity
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void setPositions();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn applyBorder
   ///
   /// Applies border pixels around the current content
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void applyBorder();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn removeBorder
   ///
   /// Removes border pixels from the current content
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void removeBorder();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn calculateBorderDimensions
   ///
   /// Calculates the border dimensions based on content
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void calculateBorderDimensions();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn storeOriginalSprite
   ///
   /// Stores the original sprite pixels for border restoration
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void storeOriginalSprite();

public:
   UIElement();
   UIElement(const std::string printableName, const std::vector<Animation> animations, const bool visable,
             const bool moveableByCamera);

   static std::vector<std::shared_ptr<UIElement>> topMiddleUIElements;
   static std::vector<std::shared_ptr<UIElement>> rightMiddleUIElements;
   static std::vector<std::shared_ptr<UIElement>> bottomMiddleUIElements;
   static std::vector<std::shared_ptr<UIElement>> leftMiddleUIElements;
   static std::vector<std::shared_ptr<UIElement>> topLeftUIElements;
   static std::vector<std::shared_ptr<UIElement>> topRightUIElements;
   static std::vector<std::shared_ptr<UIElement>> bottomRightUIElements;
   static std::vector<std::shared_ptr<UIElement>> bottomLeftUIElements;
   static std::vector<std::shared_ptr<UIElement>> middleUIElements;

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn setDynamicPosition
   ///
   /// @param position - Locks the element to this terminal edge/corner
   /// @param direction - If in a corner, can set the dynamic stacking direction to be vertical or horizontal
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void setDynamicPosition(ScreenLockPosition position, StackDirection direction = StackDirection::VERTICAL);

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn updateAllLockedPositions
   ///
   /// Updates all elements. Gets called every time the terminal gets resized
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   static void updateAllLockedPositions();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn updateStdscrLockedPositions
   ///
   /// Updates only UI elements that are locked to stdscr (global screen)
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   static void updateStdscrLockedPositions();

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn updateWindowLockedPositions
   ///
   /// Updates UI elements that are locked to a specific window
   ///
   /// @param targetWindow - The window to update elements for
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   static void updateWindowLockedPositions(WINDOW* targetWindow);

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn cleanupExpiredElements
   ///
   /// Removes expired shared_ptr elements from all positioning vectors
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   static void cleanupExpiredElements();
   static void removeFromPositioningVectors(std::shared_ptr<UIElement> element);

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn displace
   ///
   /// @param dx - X axis difference
   /// @param dy - Y axis difference
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void displace(int dx, int dy) override;

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn setBorder
   ///
   /// Enables or disables border with automatic sizing around content
   ///
   /// @param enabled - Whether to enable or disable the border
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void setBorder(bool enabled);

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn setBorder
   ///
   /// Enables or disables border with specific dimensions
   ///
   /// @param enabled - Whether to enable or disable the border
   /// @param width - Width of the border area
   /// @param height - Height of the border area
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   void setBorder(bool enabled, int width, int height);

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   /// @fn isBorderEnabled
   ///
   /// @return Whether the border is currently enabled
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////
   bool isBorderEnabled() const;

   std::shared_ptr<UIElement> getptr() { return shared_from_this(); }
};

#endif